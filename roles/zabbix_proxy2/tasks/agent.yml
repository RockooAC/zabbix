- name: Install Zabbix agent on proxy host (aligned with zabbix_agent3 role)
  when: zabbix_proxy_agent_enabled | bool
  block:
    - name: Reuse zabbix_agent3 role for proxy agent configuration
      ansible.builtin.import_role:
        name: zabbix_agent3
      vars:
        zabbix_packages: "{{ zabbix_proxy_agent_packages }}"
        zabbix_server_ip: "{{ zabbix_proxy_agent_server }}"
        zabbix_active_server: "{{ zabbix_proxy_agent_server_active }}"
        zabbix_agent_hostname: "{{ zabbix_proxy_agent_hostname | default(ansible_hostname) }}"
        zabbix_agent_host_metadata: "{{ zabbix_proxy_agent_host_metadata_effective }}"
        host_metadata_item: "{{ zabbix_proxy_agent_host_metadata_item }}"
        zabbix_agent_autoreg_groups: "{{ zabbix_proxy_agent_autoreg_groups }}"
        zabbix_agent_tls_psk_value: "{{ zabbix_proxy_agent_tls_psk_value }}"
        zabbix_agent_tls_psk_enable: "{{ zabbix_proxy_agent_tls_psk_enable }}"
        tLSPSKIdentity: "{{ zabbix_proxy_agent_tls_psk_identity }}"
        tLSPSKFile: "{{ zabbix_proxy_agent_tls_psk_file }}"
        tLSConnect: "{{ zabbix_proxy_agent_tls_connect }}"
        tLSAccept: "{{ zabbix_proxy_agent_tls_accept }}"
